<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù¾Ù†Ù„ CRM Ú©Ø§Ø±Ø´Ù†Ø§Ø³</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', Tahoma, sans-serif; }
    body {
      background: #f9fafc;
      min-height: 100vh;
      padding: 24px;
      color: #2e353b;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e0e4e9;
    }
    .header h1 {
      font-size: 20px;
      font-weight: 700;
      color: #509ee3;
    }
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    /* Search Box */
    .search-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #e0e4e9;
    }
    .search-row {
      display: flex;
      gap: 10px;
    }
    .search-row input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #e0e4e9;
      border-radius: 6px;
      font-size: 14px;
      direction: ltr;
      text-align: left;
      transition: all 0.2s;
    }
    .search-row input:focus {
      outline: none;
      border-color: #509ee3;
      box-shadow: 0 0 0 2px rgba(80,158,227,0.15);
    }
    .search-row input::placeholder {
      font-family: 'Vazirmatn', Tahoma, sans-serif;
      direction: rtl;
    }
    .btn {
      padding: 10px 20px;
      border: 1px solid #e0e4e9;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      background: white;
      color: #2e353b;
    }
    .btn:hover {
      background: #f9fafc;
      border-color: #c0c6cc;
    }
    .btn-primary {
      background: #509ee3;
      color: white;
      border-color: #509ee3;
    }
    .btn-primary:hover {
      background: #4a90d1;
      border-color: #4a90d1;
    }
    .btn-small {
      padding: 6px 14px;
      font-size: 12px;
    }
    .btn-success {
      background: #84bb4c;
      color: white;
      border-color: #84bb4c;
    }
    .btn-success:hover {
      background: #75a943;
      border-color: #75a943;
    }
    .btn-back {
      background: #7c8590;
      color: white;
      border-color: #7c8590;
    }
    .btn-back:hover {
      background: #6c757d;
      border-color: #6c757d;
    }
    
    /* Result Panel */
    #result { display: none; }
    #serviceDetails { display: none; }
    
    /* Back Button */
    .back-button {
      margin-bottom: 16px;
    }
    
    /* Export Bar */
    .export-bar {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    /* Service Cards Grid */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .service-card {
      background: white;
      border: 1px solid #e0e4e9;
      border-radius: 8px;
      padding: 20px;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .service-card:hover {
      border-color: #509ee3;
      box-shadow: 0 4px 12px rgba(80,158,227,0.15);
      transform: translateY(-2px);
    }
    
    .service-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      padding-bottom: 14px;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .service-icon {
      width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .service-icon.insurance { background: #e3f2fd; }
    .service-icon.ai { background: #f3e5f5; }
    .service-icon.audiobook { background: #fff3e0; }
    .service-icon.vod { background: #fce4ec; }
    
    .service-title {
      flex: 1;
    }
    
    .service-title h4 {
      font-size: 15px;
      font-weight: 700;
      color: #2e353b;
      margin-bottom: 4px;
    }
    
    .service-title p {
      font-size: 11px;
      color: #7c8590;
    }
    
    .service-info {
      margin-bottom: 14px;
    }
    
    .service-info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
    }
    
    .service-info-row label {
      color: #7c8590;
    }
    
    .service-info-row span {
      color: #2e353b;
      font-weight: 600;
    }
    
    .service-actions {
      display: flex;
      gap: 8px;
    }
    
    .badge-demo {
      display: inline-block;
      background: #f9a825;
      color: white;
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: 600;
    }
    
    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid #e0e4e9;
    }
    .section h3 {
      color: #509ee3;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f0f2f5;
      font-size: 14px;
      font-weight: 700;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
    }
    .info-item {
      background: #f9fafc;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #eef0f3;
    }
    .info-item label {
      display: block;
      font-size: 11px;
      color: #7c8590;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .info-item span {
      font-size: 13px;
      font-weight: 600;
      color: #2e353b;
    }
    
    /* Status Colors */
    .status-active { color: #84bb4c !important; }
    .status-expired { color: #ed6e6e !important; }
    .status-pending { color: #f9a825 !important; }
    .status-canceled { color: #7c8590 !important; }
    
    /* Payment Timeline */
    .timeline-label {
      margin-top: 16px;
      font-size: 12px;
      color: #7c8590;
      margin-bottom: 10px;
      font-weight: 500;
    }
    .payment-timeline {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .installment {
      width: 36px;
      height: 36px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    .installment.paid { background: #84bb4c; }
    .installment.pending { background: #f9a825; }
    .installment.failed { background: #ed6e6e; }
    .installment.future { background: #509ee3; }
    
    .timeline-legend {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #7c8590;
    }
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 3px;
    }
    .legend-dot.paid { background: #84bb4c; }
    .legend-dot.pending { background: #f9a825; }
    .legend-dot.failed { background: #ed6e6e; }
    .legend-dot.future { background: #509ee3; }
    
    /* Actions */
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    /* History Table */
    .table-wrapper {
      overflow-x: auto;
      border-radius: 6px;
      border: 1px solid #e0e4e9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      padding: 12px 14px;
      text-align: right;
    }
    th { 
      background: #f9fafc;
      color: #7c8590;
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      border-bottom: 1px solid #e0e4e9;
    }
    td {
      border-bottom: 1px solid #f0f2f5;
      color: #2e353b;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #f9fafc; }
    
    /* Error Message */
    .error-box {
      background: #fef6f6;
      border: 1px solid #f5c6c6;
      border-radius: 6px;
      padding: 14px;
      text-align: center;
      color: #ed6e6e;
      margin-bottom: 16px;
      display: none;
      font-size: 13px;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: #2e353b;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      display: none;
      font-size: 13px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
    }
    
    /* Print Styles */
    @media print {
      body { background: white; padding: 0; }
      .header-actions, .export-bar, .actions, .search-box, .back-button, .service-actions { display: none !important; }
      .section { border: 1px solid #ddd; box-shadow: none; }
      .service-card { break-inside: avoid; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Ù¾Ù†Ù„ CRM Ú©Ø§Ø±Ø´Ù†Ø§Ø³</h1>
      <div class="header-actions">
        <button class="btn" onclick="showToast('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡')">Ø±Ø§Ù‡Ù†Ù…Ø§</button>
      </div>
    </div>
    
    <!-- Search -->
    <div class="search-box">
      <div class="search-row">
        <input type="text" id="phoneInput" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" maxlength="11">
        <button class="btn btn-primary" onclick="search()">Ø¬Ø³ØªØ¬Ùˆ</button>
      </div>
    </div>
    
    <!-- Error -->
    <div class="error-box" id="errorBox"></div>
    
    <!-- Results - Layer 1: Overview & Services List -->
    <div id="result">
      <!-- Subscriber Overview -->
      <div class="section">
        <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ Ù…Ø´ØªØ±Ú©</h3>
        <div class="info-grid" id="subscriberOverview"></div>
      </div>
      
      <!-- Active Services -->
      <div class="section">
        <h3>Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
        <div class="services-grid" id="servicesGrid"></div>
      </div>
    </div>
    
    <!-- Layer 2: Service Details (Insurance) -->
    <div id="serviceDetails">
      <div class="back-button">
        <button class="btn btn-back" onclick="backToOverview()">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§</button>
      </div>
      
      <!-- Export Bar -->
      <div class="export-bar">
        <button class="btn" onclick="showToast('Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯')">Ø®Ø±ÙˆØ¬ÛŒ Excel</button>
        <button class="btn" onclick="window.print()">Ú†Ø§Ù¾</button>
      </div>
      
      <!-- Policy Info -->
      <div class="section">
        <h3>ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</h3>
        <div class="info-grid" id="policyInfo"></div>
      </div>
      
      <!-- Device Info -->
      <div class="section">
        <h3>ğŸ“± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¨ÛŒÙ…Ù‡â€ŒØ´Ø¯Ù‡</h3>
        <div class="info-grid" id="deviceInfo"></div>
      </div>
      
      <!-- Coverage Info -->
      <div class="section">
        <h3>ğŸ›¡ï¸ Ù¾ÙˆØ´Ø´â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡</h3>
        <div class="info-grid" id="coverageInfo"></div>
      </div>
      
      <!-- Insured Info -->
      <div class="section">
        <h3>ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒÙ…Ù‡â€ŒÚ¯Ø°Ø§Ø±</h3>
        <div class="info-grid" id="insuredInfo"></div>
      </div>
      
      <!-- Payment Info -->
      <div class="section">
        <h3>ğŸ’³ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„ÛŒ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
        <div class="info-grid" id="paymentInfo"></div>
        <p class="timeline-label">ÙˆØ¶Ø¹ÛŒØª Ø§Ù‚Ø³Ø§Ø·:</p>
        <div class="payment-timeline" id="installments"></div>
        <div class="timeline-legend">
          <div class="legend-item"><span class="legend-dot paid"></span> Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</div>
          <div class="legend-item"><span class="legend-dot pending"></span> Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
          <div class="legend-item"><span class="legend-dot failed"></span> Ù†Ø§Ù…ÙˆÙÙ‚</div>
          <div class="legend-item"><span class="legend-dot future"></span> Ø³Ø±Ø±Ø³ÛŒØ¯ Ù†Ø´Ø¯Ù‡</div>
        </div>
      </div>
      
      <!-- Claims History -->
      <div class="section" id="claimsSection" style="display: none;">
        <h3>ğŸ”§ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø³Ø§Ø±Ø§Øª</h3>
        <div class="table-wrapper">
          <table id="claimsTable">
            <thead>
              <tr><th>Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±ÙˆÙ†Ø¯Ù‡</th><th>ØªØ§Ø±ÛŒØ®</th><th>Ù†ÙˆØ¹ Ø®Ø³Ø§Ø±Øª</th><th>Ù…Ø¨Ù„Øº</th><th>ÙØ±Ø§Ù†Ø´ÛŒØ²</th><th>Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Subscriber Info -->
      <div class="section">
        <h3>ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø· Ù…ÙˆØ¨Ø§ÛŒÙ„</h3>
        <div class="info-grid" id="subscriberInfo"></div>
      </div>
      
      <!-- History -->
      <div class="section">
        <h3>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ¹Ø§Ù…Ù„</h3>
        <div class="table-wrapper">
          <table id="historyTable">
            <thead>
              <tr><th>ØªØ§Ø±ÛŒØ®</th><th>Ù†ÙˆØ¹</th><th>Ø´Ø±Ø­</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Documents -->
      <div class="section">
        <h3>ğŸ“„ Ø§Ø³Ù†Ø§Ø¯ Ùˆ Ù…Ø¯Ø§Ø±Ú©</h3>
        <div class="table-wrapper">
          <table id="documentsTable">
            <thead>
              <tr><th>Ù†Ø§Ù… Ø³Ù†Ø¯</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ÙØ±Ù…Øª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
      <!-- Actions -->
      <div class="section">
        <h3>âš¡ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ú©Ø§Ø±Ø´Ù†Ø§Ø³</h3>
        <div class="actions">
          <button class="btn btn-success" onclick="showToast('Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯')">ğŸ“¥ Ø§Ø±Ø³Ø§Ù„ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</button>
          <button class="btn btn-primary" onclick="showToast('Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯')">ğŸ’³ Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª</button>
          <button class="btn" onclick="showToast('Ú¯Ø²Ø§Ø±Ø´ Ø³Ø±Ù‚Øª Ø«Ø¨Øª Ø´Ø¯')">ğŸš¨ Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø³Ø±Ù‚Øª</button>
          <button class="btn" onclick="showToast('Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÙ…Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯')">ğŸ”„ ØªÙ…Ø¯ÛŒØ¯ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</button>
          <button class="btn" onclick="showToast('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù„ØºÙˆ Ø«Ø¨Øª Ø´Ø¯')">âŒ Ù„ØºÙˆ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</button>
          <button class="btn" onclick="showToast('ØªÛŒÚ©Øª Ø§Ø±Ø¬Ø§Ø¹ Ø«Ø¨Øª Ø´Ø¯')">ğŸ“¨ Ø§Ø±Ø¬Ø§Ø¹ Ø¨Ù‡ Ø¨ÛŒÙ…Ù‡â€ŒÚ¯Ø±</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    let currentUserData = null;
    
    // ØªÙˆÙ„ÛŒØ¯ Ø¯Ø§Ø¯Ù‡ Ø±Ù†Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ú†Ù†Ø¯ Ø³Ø±ÙˆÛŒØ³
    function generateUserServices(phone) {
      const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
      const randNum = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
      const formatPrice = (n) => n.toLocaleString('fa-IR');
      const randDate = () => `1404/${String(randNum(1, 12)).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`;
      
      const services = [];
      
      // 1. Ø¨ÛŒÙ…Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ (Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„) - Ù‡Ù…ÛŒØ´Ù‡ ÙØ¹Ø§Ù„
      const statuses = [
          { text: 'ÙØ¹Ø§Ù„', class: 'status-active' },
          { text: 'Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡', class: 'status-expired' },
          { text: 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª', class: 'status-pending' }
        ];
        const coverages = ['Ø·Ø±Ø­ Ø§ÙˆÙ„', 'Ø·Ø±Ø­ Ø¯ÙˆÙ…', 'Ø·Ø±Ø­ Ø³ÙˆÙ…', 'Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…', 'Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…'];
        const brands = ['Samsung', 'Apple', 'Xiaomi', 'Huawei', 'Nokia'];
        const models = {
          Samsung: ['Galaxy S23', 'Galaxy A54', 'Galaxy Z Fold 5', 'Galaxy A34'],
          Apple: ['iPhone 15 Pro', 'iPhone 14', 'iPhone 13', 'iPhone 15'],
          Xiaomi: ['Redmi Note 13', 'Poco X6', 'Mi 13', '14 Pro'],
          Huawei: ['P60 Pro', 'Nova 11', 'Mate 50', 'P50'],
          Nokia: ['G60', 'X30', 'G21', 'C31']
        };
        const colors = ['Ù…Ø´Ú©ÛŒ', 'Ø³ÙÛŒØ¯', 'Ø¢Ø¨ÛŒ', 'Ø·Ù„Ø§ÛŒÛŒ', 'Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ', 'Ù‚Ø±Ù…Ø²'];
        const names = ['Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ', 'Ù…Ø­Ù…Ø¯ Ø­Ø³ÛŒÙ†ÛŒ', 'Ø±Ø¶Ø§ Ú©Ø±ÛŒÙ…ÛŒ', 'ÙØ§Ø·Ù…Ù‡ Ø±Ø¶Ø§ÛŒÛŒ', 'Ù…Ø±ÛŒÙ… Ù…Ø­Ù…Ø¯ÛŒ', 'Ø³Ø§Ø±Ø§ Ù†ÙˆØ±ÛŒ'];
        const cities = ['ØªÙ‡Ø±Ø§Ù†', 'Ù…Ø´Ù‡Ø¯', 'Ø§ØµÙÙ‡Ø§Ù†', 'Ø´ÛŒØ±Ø§Ø²', 'ØªØ¨Ø±ÛŒØ²', 'Ú©Ø±Ø¬'];
        
        const status = rand(statuses);
        const coverage = rand(coverages);
        const brand = rand(brands);
        const model = rand(models[brand]);
        // Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª - Ø¨ÛŒØ´ØªØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† DCB Ù‡Ø³ØªÙ†Ø¯
        const isIpg = Math.random() < 0.2; // Ø­Ø¯ÙˆØ¯ 20% IPG Ùˆ 80% DCB
        const installmentCount = isIpg ? 1 : 12;
        
        // ØªÙˆÙ„ÛŒØ¯ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø·Ù‚ÛŒ
        const issueMonth = randNum(1, 12);
        const issueDay = randNum(1, 28);
        const issueDate = `1403/${String(issueMonth).padStart(2, '0')}/${String(issueDay).padStart(2, '0')}`;
        const startDate = issueDate;
        const endMonth = issueMonth;
        const endYear = 1404;
        const endDate = `${endYear}/${String(endMonth).padStart(2, '0')}/${String(issueDay).padStart(2, '0')}`;
        const purchaseDate = `1403/${String(Math.max(1, issueMonth - 2)).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`;
        
        const imei = Array(15).fill(0).map(() => randNum(0, 9)).join('');
        // Ø³Ù‚Ù Ù‚ÛŒÙ…Øª Ú¯ÙˆØ´ÛŒ: Ø­Ø¯Ø§Ú©Ø«Ø± 30 Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†
        const deviceValue = randNum(5, 30) * 10000000; // Ø±ÛŒØ§Ù„ (5 ØªØ§ 30 Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†)

        // ØªÙ†Ø¸ÛŒÙ… Ù…Ù†Ø·Ù‚ÛŒ Ø¯Ø±ØµØ¯ Ù¾ÙˆØ´Ø´ Ùˆ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡
        const planConfig = {
          'Ø·Ø±Ø­ Ø§ÙˆÙ„': { monthlyInstallmentToman: 5000, franchise: '10%', waitingPeriod: '72 Ø³Ø§Ø¹Øª', documentRequired: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª + Ú©Ø§Ø±Øª Ù…Ù„ÛŒ + ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯/IMEI', conditions: 'Ù¾ÙˆØ´Ø´ Ø³Ø±Ù‚Øª Ù¾Ø§ÛŒÙ‡' },
          'Ø·Ø±Ø­ Ø¯ÙˆÙ…': { monthlyInstallmentToman: 10000, franchise: '10%', waitingPeriod: '72 Ø³Ø§Ø¹Øª', documentRequired: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª + Ú©Ø§Ø±Øª Ù…Ù„ÛŒ + ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯/IMEI + Ù†Ø§Ù…Ù‡ Ù…Ø³Ø¯ÙˆØ¯ÛŒ Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª', conditions: 'Ù¾ÙˆØ´Ø´ Ø³Ø±Ù‚Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯' },
          'Ø·Ø±Ø­ Ø³ÙˆÙ…': { monthlyInstallmentToman: 15000, franchise: '10%', waitingPeriod: '72 Ø³Ø§Ø¹Øª', documentRequired: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª + Ú©Ø§Ø±Øª Ù…Ù„ÛŒ + ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯/IMEI + Ù†Ø§Ù…Ù‡ Ù…Ø³Ø¯ÙˆØ¯ÛŒ Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª', conditions: 'Ù¾ÙˆØ´Ø´ Ú©Ø§Ù…Ù„ Ø³Ø±Ù‚Øª' },
          'Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…': { monthlyInstallmentToman: 20000, franchise: '10%', waitingPeriod: '72 Ø³Ø§Ø¹Øª', documentRequired: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª + Ú©Ø§Ø±Øª Ù…Ù„ÛŒ + Ù†Ø§Ù…Ù‡ Ù…Ø³Ø¯ÙˆØ¯ÛŒ Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª', conditions: 'Ù¾ÙˆØ´Ø´ ÙÙˆØ±ÛŒ Ø³Ø±Ù‚Øª' },
          'Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…': { monthlyInstallmentToman: 25000, franchise: '10%', waitingPeriod: '72 Ø³Ø§Ø¹Øª', documentRequired: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª + Ú©Ø§Ø±Øª Ù…Ù„ÛŒ + Ù†Ø§Ù…Ù‡ Ù…Ø³Ø¯ÙˆØ¯ÛŒ Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª + Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø±Ø¬ÛŒØ³ØªØ±ÛŒ', conditions: 'Ù¾ÙˆØ´Ø´ ÙˆÛŒÚ˜Ù‡ Ø³Ø±Ù‚Øª Ø¨Ø§ Ø§ÙˆÙ„ÙˆÛŒØª Ø±Ø³ÛŒØ¯Ú¯ÛŒ' }
        };
        const plan = planConfig[coverage];
        const coveragePercent = 0.9; // Ø³Ù‚Ù Ù¾ÙˆØ´Ø´ Ø«Ø§Ø¨Øª: 90%
        const maxCoverageAmount = Math.floor(deviceValue * coveragePercent);
        const monthlyInstallmentToman = plan.monthlyInstallmentToman;
        const totalPriceToman = monthlyInstallmentToman * 12;

        // ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª: DCB Ø§Ù‚Ø³Ø§Ø·ÛŒ / IPG ÛŒÚ©Ø¬Ø§
        let paidCount;
        if (isIpg) {
          paidCount = (status.text === 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª') ? 0 : 1;
        } else {
          paidCount = status.text === 'Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡'
            ? installmentCount
            : status.text === 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª'
              ? randNum(0, 10)
              : randNum(1, 11);
        }
        const paidAmountToman = isIpg
          ? (paidCount === 1 ? totalPriceToman : 0)
          : monthlyInstallmentToman * paidCount;
        
        const installments = [];
        for (let i = 0; i < installmentCount; i++) {
          if (i < paidCount) installments.push('paid');
          else if (i === paidCount && status.text !== 'Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡') installments.push('pending');
          else installments.push('future');
        }
        
        // ØªÙˆÙ„ÛŒØ¯ Ø®Ø³Ø§Ø±Ø§Øª Ø³Ø±Ù‚Øª (Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯)
        const claimsCount = Math.random() > 0.85 ? 1 : 0; // Ø³Ø±Ù‚Øª Ù†Ø§Ø¯Ø± Ø§Ø³Øª
        const claims = [];
        if (claimsCount > 0) {
          const claimStatuses = [
            { text: 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ', class: 'status-pending' },
            { text: 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ - Ù…Ù†ØªØ¸Ø± Ù¾Ø±Ø¯Ø§Ø®Øª', class: 'status-active' },
            { text: 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡', class: 'status-active' },
            { text: 'Ø±Ø¯ Ø´Ø¯Ù‡', class: 'status-expired' }
          ];
          
          const claimStatus = rand(claimStatuses);
          const claimMonth = randNum(1, 12);
          const claimAmount = maxCoverageAmount;
          const franchisePercent = coverage === 'Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…' ? 0.05 : coverage === 'Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…' ? 0.07 : coverage === 'Ø·Ø±Ø­ Ø³ÙˆÙ…' ? 0.10 : coverage === 'Ø·Ø±Ø­ Ø¯ÙˆÙ…' ? 0.12 : 0.15;
          const franchise = Math.floor(claimAmount * franchisePercent);
          const payableAmount = claimAmount - franchise;
          
          claims.push({
            claimNo: `THEFT-${randNum(1000, 9999)}`,
            date: `1403/${String(claimMonth).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`,
            type: 'Ø³Ø±Ù‚Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„',
            amount: formatPrice(claimAmount),
            franchise: formatPrice(franchise),
            payable: formatPrice(payableAmount),
            status: claimStatus.text,
            statusClass: claimStatus.class,
            policeReportNo: `POL-${randNum(100000, 999999)}`,
            reportDate: `1403/${String(claimMonth).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`
          });
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÙˆØ´Ø´â€ŒÙ‡Ø§ÛŒ Ø³Ø±Ù‚Øª (Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡)
        const coverageDetails = {
          'Ø·Ø±Ø­ Ø§ÙˆÙ„': {
            theftCoverage: '90% Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡',
            maxCoverage: formatPrice(Math.floor(deviceValue * 0.9)),
            franchise: planConfig['Ø·Ø±Ø­ Ø§ÙˆÙ„'].franchise,
            conditions: planConfig['Ø·Ø±Ø­ Ø§ÙˆÙ„'].conditions,
            waitingPeriod: planConfig['Ø·Ø±Ø­ Ø§ÙˆÙ„'].waitingPeriod,
            documentRequired: planConfig['Ø·Ø±Ø­ Ø§ÙˆÙ„'].documentRequired
          },
          'Ø·Ø±Ø­ Ø¯ÙˆÙ…': {
            theftCoverage: '90% Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡',
            maxCoverage: formatPrice(Math.floor(deviceValue * 0.9)),
            franchise: planConfig['Ø·Ø±Ø­ Ø¯ÙˆÙ…'].franchise,
            conditions: planConfig['Ø·Ø±Ø­ Ø¯ÙˆÙ…'].conditions,
            waitingPeriod: planConfig['Ø·Ø±Ø­ Ø¯ÙˆÙ…'].waitingPeriod,
            documentRequired: planConfig['Ø·Ø±Ø­ Ø¯ÙˆÙ…'].documentRequired
          },
          'Ø·Ø±Ø­ Ø³ÙˆÙ…': {
            theftCoverage: '90% Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡',
            maxCoverage: formatPrice(Math.floor(deviceValue * 0.9)),
            franchise: planConfig['Ø·Ø±Ø­ Ø³ÙˆÙ…'].franchise,
            conditions: planConfig['Ø·Ø±Ø­ Ø³ÙˆÙ…'].conditions,
            waitingPeriod: planConfig['Ø·Ø±Ø­ Ø³ÙˆÙ…'].waitingPeriod,
            documentRequired: planConfig['Ø·Ø±Ø­ Ø³ÙˆÙ…'].documentRequired
          },
          'Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…': {
            theftCoverage: '90% Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡',
            maxCoverage: formatPrice(Math.floor(deviceValue * 0.9)),
            franchise: planConfig['Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…'].franchise,
            conditions: planConfig['Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…'].conditions,
            waitingPeriod: planConfig['Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…'].waitingPeriod,
            documentRequired: planConfig['Ø·Ø±Ø­ Ú†Ù‡Ø§Ø±Ù…'].documentRequired
          },
          'Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…': {
            theftCoverage: '90% Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡',
            maxCoverage: formatPrice(Math.floor(deviceValue * 0.9)),
            franchise: planConfig['Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…'].franchise,
            conditions: planConfig['Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…'].conditions,
            waitingPeriod: planConfig['Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…'].waitingPeriod,
            documentRequired: planConfig['Ø·Ø±Ø­ Ù¾Ù†Ø¬Ù…'].documentRequired
          }
        };
        
        const insuredCity = rand(cities);

        services.push({
          id: 'insurance',
          type: 'Ø¨ÛŒÙ…Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„',
          name: `Ø¨ÛŒÙ…Ù‡ ${coverage}`,
          icon: 'ğŸ›¡ï¸',
          status: status.text,
          statusClass: status.class,
          expiry: endDate,
          price: `${formatPrice(monthlyInstallmentToman)} ØªÙˆÙ…Ø§Ù†/Ù…Ø§Ù‡`,
          hasDetails: true,
          details: {
            policy: {
              policyNo: `INS-2024-${randNum(10000, 99999)}`,
              issueDate: issueDate,
              startDate: startDate,
              endDate: endDate,
              status: status.text,
              statusClass: status.class,
              coverage: coverage,
              insuranceType: 'Ø¨ÛŒÙ…Ù‡ Ø³Ø±Ù‚Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„',
              insurer: 'iBimeh - Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù‡Ù…Ø±Ø§Ù‡ Ø§ÙˆÙ„',
              policyDuration: '12 Ù…Ø§Ù‡',
              autoRenew: rand(['ÙØ¹Ø§Ù„', 'ØºÛŒØ±ÙØ¹Ø§Ù„'])
            },
            device: {
              brand: brand,
              model: model,
              imei: imei,
              color: rand(colors),
              purchaseDate: purchaseDate,
              deviceValue: formatPrice(deviceValue),
              condition: rand(['Ù†Ùˆ', 'Ú©Ø§Ø±Ú©Ø±Ø¯Ù‡', 'Ø§Ø³ØªÙˆÚ©']),
              serialNo: `SN-${randNum(100000, 999999)}`
            },
            coverage: {
              theftCoverage: coverageDetails[coverage].theftCoverage,
              maxCoverage: coverageDetails[coverage].maxCoverage,
              franchise: coverageDetails[coverage].franchise,
              conditions: coverageDetails[coverage].conditions,
              waitingPeriod: coverageDetails[coverage].waitingPeriod,
              documentRequired: coverageDetails[coverage].documentRequired
            },
            insured: {
              name: rand(names),
              nationalId: `${randNum(100, 999)}${randNum(1000000, 9999999)}`,
              mobile: phone,
              city: insuredCity,
              address: `${insuredCity}ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† ${rand(['ÙˆÙ„ÛŒØ¹ØµØ±', 'Ø¢Ø²Ø§Ø¯ÛŒ', 'Ø§Ù†Ù‚Ù„Ø§Ø¨', 'Ù…Ø·Ù‡Ø±ÛŒ'])}ØŒ Ù¾Ù„Ø§Ú© ${randNum(10, 999)}`
            },
            payment: {
              monthlyPrice: formatPrice(monthlyInstallmentToman),
              installmentCount: installmentCount,
              paidCount: paidCount,
              paidAmount: formatPrice(paidAmountToman),
              remainingAmount: formatPrice(totalPriceToman - paidAmountToman),
              nextDueDate: paidCount < installmentCount
                ? (isIpg ? issueDate : `1404/${String(((issueMonth + paidCount - 1) % 12) + 1).padStart(2, '0')}/${String(issueDay).padStart(2, '0')}`)
                : '-',
              nextAmount: paidCount < installmentCount
                ? formatPrice(isIpg ? totalPriceToman : monthlyInstallmentToman)
                : '-',
              paymentMethod: isIpg ? 'Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ (IPG)' : 'Ú©Ø³Ø± Ø§Ø² Ø§Ø¹ØªØ¨Ø§Ø± (DCB)',
              billingType: isIpg ? 'ÛŒÚ©Ø¬Ø§ (ØºÛŒØ± Ø§Ù‚Ø³Ø§Ø·ÛŒ)' : 'Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡ (Ø§Ù‚Ø³Ø§Ø·ÛŒ)',
              installments: installments
            },
            claims: claims,
            subscriber: {
              type: rand(['Ø¯Ø§Ø¦Ù…ÛŒ', 'Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ']),
              simStatus: rand(['Ø¹Ø§Ø¯ÛŒ', 'Ù…Ø³Ø¯ÙˆØ¯ Ù…ÙˆÙ‚Øª']),
              creditScore: rand(['Ú©Ù…', 'Ù…ØªÙˆØ³Ø·', 'Ø²ÛŒØ§Ø¯']),
              registrationDate: `1400/${String(randNum(1, 12)).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`,
              activationChannel: rand(['USSD (*555#)', 'My MCI App', 'SMS'])
            },
            history: Array(randNum(5, 10)).fill(0).map(() => {
              const historyTypes = [
                { type: 'Ù¾Ø±Ø¯Ø§Ø®Øª', desc: 'Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø³Ø· - Ù…ÙˆÙÙ‚' },
                { type: 'Ù¾Ø±Ø¯Ø§Ø®Øª', desc: 'Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø³Ø· - Ù†Ø§Ù…ÙˆÙÙ‚' },
                { type: 'ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ', desc: 'Ø§Ø±Ø³Ø§Ù„ ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø³Ø±Ø±Ø³ÛŒØ¯ Ù‚Ø³Ø·' },
                { type: 'Ø§Ø³ØªØ¹Ù„Ø§Ù…', desc: 'Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡' },
                { type: 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ', desc: 'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø±Ú©Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ' },
                { type: 'Ø³ÛŒØ³ØªÙ…', desc: 'Ø§Ø±Ø³Ø§Ù„ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„' },
                { type: 'Ø®Ø³Ø§Ø±Øª', desc: 'Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø³Ø±Ù‚Øª' },
                { type: 'ØªÙ…Ø¯ÛŒØ¯', desc: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÙ…Ø¯ÛŒØ¯ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡' }
              ];
              const item = rand(historyTypes);
              return {
                date: randDate(),
                type: item.type,
                desc: item.desc
              };
            }).sort((a, b) => b.date.localeCompare(a.date)),
            documents: [
              { name: 'Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡ Ø§ØµÙ„ÛŒ', status: 'Ù…ÙˆØ¬ÙˆØ¯', format: 'PDF' },
              { name: 'Ø§ØµÙ„ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù„Ø§Ù†ØªØ±ÛŒ Ø³Ø±Ù‚Øª', status: 'Ù…ÙˆØ¬ÙˆØ¯', format: 'PDF' },
              { name: 'Ù†Ø§Ù…Ù‡ Ù…Ø³Ø¯ÙˆØ¯ÛŒ Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª', status: 'Ù…ÙˆØ¬ÙˆØ¯', format: 'PDF' },
              { name: 'ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯ ÛŒØ§ Ø§Ø³ØªØ¹Ù„Ø§Ù… IMEI', status: 'Ù…ÙˆØ¬ÙˆØ¯', format: 'PDF' },
              { name: 'ØªØµÙˆÛŒØ± Ú©Ø§Ø±Øª Ù…Ù„ÛŒ', status: 'Ù…ÙˆØ¬ÙˆØ¯', format: 'JPG' }
            ]
          }
        });
      
      // 2. Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (Demo)
      if (Math.random() > 0.3) {
        services.push({
          id: 'ai',
          type: 'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ',
          name: 'AI Assistant',
          icon: 'ğŸ¤–',
          status: 'ÙØ¹Ø§Ù„',
          statusClass: 'status-active',
          expiry: randDate(),
          price: `${formatPrice(randNum(50, 200) * 1000)} Ø±ÛŒØ§Ù„/Ù…Ø§Ù‡`,
          hasDetails: false,
          demo: true
        });
      }
      
      // 3. Ú©ØªØ§Ø¨ ØµÙˆØªÛŒ (Demo)
      if (Math.random() > 0.4) {
        services.push({
          id: 'audiobook',
          type: 'Ú©ØªØ§Ø¨ ØµÙˆØªÛŒ',
          name: 'Audiobook Premium',
          icon: 'ğŸ§',
          status: 'ÙØ¹Ø§Ù„',
          statusClass: 'status-active',
          expiry: randDate(),
          price: `${formatPrice(randNum(50, 150) * 1000)} Ø±ÛŒØ§Ù„/Ù…Ø§Ù‡`,
          hasDetails: false,
          demo: true
        });
      }
      
      // 4. VOD (Demo)
      if (Math.random() > 0.3) {
        services.push({
          id: 'vod',
          type: 'ÙˆÛŒØ¯ÛŒÙˆ Ø¢Ù†Ù„Ø§ÛŒÙ†',
          name: 'VOD Subscription',
          icon: 'ğŸ¬',
          status: 'ÙØ¹Ø§Ù„',
          statusClass: 'status-active',
          expiry: randDate(),
          price: `${formatPrice(randNum(100, 300) * 1000)} Ø±ÛŒØ§Ù„/Ù…Ø§Ù‡`,
          hasDetails: false,
          demo: true
        });
      }
      
      return services;
    }
    
    // ØªÙˆÙ„ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ Ù…Ø´ØªØ±Ú©
    function generateSubscriberOverview(phone) {
      const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
      const randNum = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
      const randDate = () => `1404/${String(randNum(1, 12)).padStart(2, '0')}/${String(randNum(1, 28)).padStart(2, '0')}`;
      
      return {
        msisdn: phone,
        type: rand(['Ø¯Ø§Ø¦Ù…ÛŒ', 'Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ']),
        simStatus: rand(['Ø¹Ø§Ø¯ÛŒ', 'Ù…Ø³Ø¯ÙˆØ¯', 'Ù‚Ø·Ø¹ ÛŒÚ©â€ŒØ·Ø±ÙÙ‡']),
        registrationDate: randDate(),
        creditScore: rand(['Ú©Ù…', 'Ù…ØªÙˆØ³Ø·', 'Ø²ÛŒØ§Ø¯']),
        activeServicesCount: '-' // Will be updated
      };
    }
    
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÛŒØ±Ø§Ù†
    function isValidIranianMobile(phone) {
      return /^09[0-9]{9}$/.test(phone);
    }

    function search() {
      const phone = document.getElementById('phoneInput').value.trim();
      const errorBox = document.getElementById('errorBox');
      const resultBox = document.getElementById('result');
      const detailsBox = document.getElementById('serviceDetails');
      
      errorBox.style.display = 'none';
      resultBox.style.display = 'none';
      detailsBox.style.display = 'none';
      
      if (!phone) {
        errorBox.textContent = 'Ù„Ø·ÙØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
        errorBox.style.display = 'block';
        return;
      }
      
      if (!isValidIranianMobile(phone)) {
        errorBox.textContent = 'Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. ÙØ±Ù…Øª ØµØ­ÛŒØ­: 09XXXXXXXXX';
        errorBox.style.display = 'block';
        return;
      }
      
      // ØªÙˆÙ„ÛŒØ¯ Ø¯Ø§Ø¯Ù‡
      const subscriberOverview = generateSubscriberOverview(phone);
      const services = generateUserServices(phone);
      subscriberOverview.activeServicesCount = services.length;
      
      currentUserData = {
        overview: subscriberOverview,
        services: services
      };
      
      // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ
      document.getElementById('subscriberOverview').innerHTML = `
        <div class="info-item"><label>MSISDN</label><span>${subscriberOverview.msisdn}</span></div>
        <div class="info-item"><label>Ù†ÙˆØ¹ Ù…Ø´ØªØ±Ú©</label><span>${subscriberOverview.type}</span></div>
        <div class="info-item"><label>ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª</label><span>${subscriberOverview.simStatus}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</label><span>${subscriberOverview.registrationDate}</span></div>
        <div class="info-item"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§Ø¹ØªØ¨Ø§Ø±</label><span>${subscriberOverview.creditScore}</span></div>
        <div class="info-item"><label>ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</label><span>${subscriberOverview.activeServicesCount}</span></div>
      `;
      
      // Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³
      const servicesHtml = services.map(service => `
        <div class="service-card" onclick="${service.hasDetails ? `showServiceDetails('${service.id}')` : `showToast('Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª')`}">
          <div class="service-header">
            <div class="service-icon ${service.id}">${service.icon}</div>
            <div class="service-title">
              <h4>${service.name}</h4>
              <p>${service.type}</p>
            </div>
            ${service.demo ? '<span class="badge-demo">DEMO</span>' : ''}
          </div>
          <div class="service-info">
            <div class="service-info-row">
              <label>ÙˆØ¶Ø¹ÛŒØª:</label>
              <span class="${service.statusClass}">${service.status}</span>
            </div>
            <div class="service-info-row">
              <label>ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§:</label>
              <span>${service.expiry}</span>
            </div>
            <div class="service-info-row">
              <label>Ù‡Ø²ÛŒÙ†Ù‡:</label>
              <span>${service.price}</span>
            </div>
          </div>
          <div class="service-actions">
            <button class="btn btn-small btn-primary" onclick="event.stopPropagation(); ${service.hasDetails ? `showServiceDetails('${service.id}')` : `showToast('Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡')`}">
              ${service.hasDetails ? 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª' : 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª'}
            </button>
          </div>
        </div>
      `).join('');
      
      document.getElementById('servicesGrid').innerHTML = servicesHtml || '<p style="color: #7c8590; text-align: center;">Ù‡ÛŒÚ† Ø³Ø±ÙˆÛŒØ³ ÙØ¹Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
      
      resultBox.style.display = 'block';
      resultBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function showServiceDetails(serviceId) {
      if (!currentUserData) return;
      
      const service = currentUserData.services.find(s => s.id === serviceId);
      if (!service || !service.hasDetails) {
        showToast('Ø¬Ø²Ø¦ÛŒØ§Øª Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª');
        return;
      }
      
      const data = service.details;
      
      // Policy Info
      document.getElementById('policyInfo').innerHTML = `
        <div class="info-item"><label>Ø´Ù…Ø§Ø±Ù‡ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</label><span>${data.policy.policyNo}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ±</label><span>${data.policy.issueDate}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹</label><span>${data.policy.startDate}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†</label><span>${data.policy.endDate}</span></div>
        <div class="info-item"><label>ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</label><span class="${data.policy.statusClass}">${data.policy.status}</span></div>
        <div class="info-item"><label>Ø³Ø·Ø­ Ù¾ÙˆØ´Ø´</label><span>${data.policy.coverage}</span></div>
        <div class="info-item"><label>Ù†ÙˆØ¹ Ø¨ÛŒÙ…Ù‡</label><span>${data.policy.insuranceType}</span></div>
        <div class="info-item"><label>Ø¨ÛŒÙ…Ù‡â€ŒÚ¯Ø±</label><span>${data.policy.insurer}</span></div>
        <div class="info-item"><label>Ù…Ø¯Øª Ø¨ÛŒÙ…Ù‡</label><span>${data.policy.policyDuration}</span></div>
        <div class="info-item"><label>ØªÙ…Ø¯ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±</label><span>${data.policy.autoRenew}</span></div>
      `;
      
      // Device Info
      document.getElementById('deviceInfo').innerHTML = `
        <div class="info-item"><label>Ø¨Ø±Ù†Ø¯</label><span>${data.device.brand}</span></div>
        <div class="info-item"><label>Ù…Ø¯Ù„</label><span>${data.device.model}</span></div>
        <div class="info-item"><label>IMEI</label><span>${data.device.imei}</span></div>
        <div class="info-item"><label>Ø´Ù…Ø§Ø±Ù‡ Ø³Ø±ÛŒØ§Ù„</label><span>${data.device.serialNo}</span></div>
        <div class="info-item"><label>Ø±Ù†Ú¯</label><span>${data.device.color}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® Ø®Ø±ÛŒØ¯</label><span>${data.device.purchaseDate}</span></div>
        <div class="info-item"><label>Ø§Ø±Ø²Ø´ Ø¯Ø³ØªÚ¯Ø§Ù‡</label><span>${data.device.deviceValue} Ø±ÛŒØ§Ù„</span></div>
        <div class="info-item"><label>ÙˆØ¶Ø¹ÛŒØª Ø¯Ø³ØªÚ¯Ø§Ù‡</label><span>${data.device.condition}</span></div>
      `;
      
      // Coverage Info
      document.getElementById('coverageInfo').innerHTML = `
        <div class="info-item"><label>Ù¾ÙˆØ´Ø´ Ø³Ø±Ù‚Øª</label><span>${data.coverage.theftCoverage}</span></div>
        <div class="info-item"><label>Ø­Ø¯Ø§Ú©Ø«Ø± Ù¾ÙˆØ´Ø´</label><span>${data.coverage.maxCoverage}</span></div>
        <div class="info-item"><label>ÙØ±Ø§Ù†Ø´ÛŒØ²</label><span>${data.coverage.franchise}</span></div>
        <div class="info-item"><label>Ù…Ø¯Øª Ø§Ù†ØªØ¸Ø§Ø±</label><span>${data.coverage.waitingPeriod}</span></div>
        <div class="info-item" style="grid-column: 1/-1;"><label>Ø´Ø±Ø§ÛŒØ· Ù¾ÙˆØ´Ø´</label><span>${data.coverage.conditions}</span></div>
        <div class="info-item" style="grid-column: 1/-1;"><label>Ù…Ø¯Ø§Ø±Ú© Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²</label><span>${data.coverage.documentRequired}</span></div>
      `;
      
      // Insured Info
      document.getElementById('insuredInfo').innerHTML = `
        <div class="info-item"><label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label><span>${data.insured.name}</span></div>
        <div class="info-item"><label>Ú©Ø¯ Ù…Ù„ÛŒ</label><span>${data.insured.nationalId}</span></div>
        <div class="info-item"><label>Ù…ÙˆØ¨Ø§ÛŒÙ„</label><span>${data.insured.mobile}</span></div>
        <div class="info-item"><label>Ø´Ù‡Ø±</label><span>${data.insured.city}</span></div>
        <div class="info-item" style="grid-column: 1/-1;"><label>Ø¢Ø¯Ø±Ø³</label><span>${data.insured.address}</span></div>
      `;
      
      // Payment Info
      document.getElementById('paymentInfo').innerHTML = `
        <div class="info-item"><label>Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡</label><span>${data.payment.monthlyPrice} ØªÙˆÙ…Ø§Ù†</span></div>
        <div class="info-item"><label>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</label><span>${data.payment.billingType}</span></div>
        <div class="info-item"><label>ØªØ¹Ø¯Ø§Ø¯ Ø§Ù‚Ø³Ø§Ø·</label><span>${data.payment.installmentCount}</span></div>
        <div class="info-item"><label>Ø§Ù‚Ø³Ø§Ø· Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</label><span>${data.payment.paidCount}</span></div>
        <div class="info-item"><label>Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</label><span>${data.payment.paidAmount} ØªÙˆÙ…Ø§Ù†</span></div>
        <div class="info-item"><label>Ù…Ø§Ù†Ø¯Ù‡ Ø¨Ø¯Ù‡ÛŒ</label><span>${data.payment.remainingAmount} ØªÙˆÙ…Ø§Ù†</span></div>
        <div class="info-item"><label>Ø³Ø±Ø±Ø³ÛŒØ¯ Ø¨Ø¹Ø¯ÛŒ</label><span>${data.payment.nextDueDate}</span></div>
        <div class="info-item"><label>Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¹Ø¯ÛŒ</label><span>${data.payment.nextAmount} ØªÙˆÙ…Ø§Ù†</span></div>
        <div class="info-item"><label>Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</label><span>${data.payment.paymentMethod}</span></div>
      `;
      
      // Installments Timeline
      document.getElementById('installments').innerHTML = data.payment.installments.map((s, i) => 
        `<div class="installment ${s}">${i + 1}</div>`
      ).join('');
      
      // Claims History (Theft)
      if (data.claims && data.claims.length > 0) {
        document.getElementById('claimsSection').style.display = 'block';
        document.querySelector('#claimsTable tbody').innerHTML = data.claims.map(c => 
          `<tr>
            <td>${c.claimNo}</td>
            <td>${c.date}</td>
            <td>${c.type}<br><small style="color: #7c8590;">Ú¯Ø²Ø§Ø±Ø´ Ù¾Ù„ÛŒØ³: ${c.policeReportNo}</small></td>
            <td>${c.amount} Ø±ÛŒØ§Ù„</td>
            <td>${c.franchise} Ø±ÛŒØ§Ù„</td>
            <td>${c.payable} Ø±ÛŒØ§Ù„</td>
            <td><span class="${c.statusClass}">${c.status}</span><br><small style="color: #7c8590;">ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´: ${c.reportDate}</small></td>
          </tr>`
        ).join('');
      } else {
        document.getElementById('claimsSection').style.display = 'none';
      }
      
      // Subscriber Info
      document.getElementById('subscriberInfo').innerHTML = `
        <div class="info-item"><label>Ù†ÙˆØ¹ Ø®Ø·</label><span>${data.subscriber.type}</span></div>
        <div class="info-item"><label>ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒÙ…â€ŒÚ©Ø§Ø±Øª</label><span>${data.subscriber.simStatus}</span></div>
        <div class="info-item"><label>Ø§Ù…ØªÛŒØ§Ø² Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ</label><span>${data.subscriber.creditScore}</span></div>
        <div class="info-item"><label>ØªØ§Ø±ÛŒØ® ÙØ¹Ø§Ù„ Ø³Ø§Ø²ÛŒ Ø³ÛŒÙ…</label><span>${data.subscriber.registrationDate}</span></div>
        <div class="info-item"><label>Ú©Ø§Ù†Ø§Ù„ ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ</label><span>${data.subscriber.activationChannel}</span></div>
      `;
      
      // History
      document.querySelector('#historyTable tbody').innerHTML = data.history.map(h => 
        `<tr><td>${h.date}</td><td>${h.type}</td><td>${h.desc}</td></tr>`
      ).join('');
      
      // Documents
      document.querySelector('#documentsTable tbody').innerHTML = data.documents.map(d => 
        `<tr>
          <td>${d.name}</td>
          <td><span class="status-active">${d.status}</span></td>
          <td>${d.format}</td>
          <td><button class="btn btn-small" onclick="showToast('Ø¯Ø§Ù†Ù„ÙˆØ¯ ${d.name}')">Ø¯Ø§Ù†Ù„ÙˆØ¯</button></td>
        </tr>`
      ).join('');
      
      // Ù†Ù…Ø§ÛŒØ´ Ù„Ø§ÛŒÙ‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ø§ØµÙ„ÛŒ
      document.getElementById('result').style.display = 'none';
      document.getElementById('serviceDetails').style.display = 'block';
      document.getElementById('serviceDetails').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function backToOverview() {
      document.getElementById('serviceDetails').style.display = 'none';
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    // Toast notification
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, 2500);
    }
    
    // Enter key support
    document.getElementById('phoneInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') search();
    });
  </script>
</body>
</html>
